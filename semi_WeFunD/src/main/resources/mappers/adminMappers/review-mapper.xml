<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminReviewMapper">

	<resultMap type="adminReview" id="ReviewResultSet">
		<result column="REVIEW_NO" property="reviewNo"/>
		<result column="NICKNAME" property="reviewWriter"/>
		<result column="SUPPORT_NO" property="supportNo"/>
		<result column="REVIEW_TITLE" property="reviewTitle"/>
		<result column="REVIEW_CONTENT" property="reviewContent"/>
		<result column="RATE" property="rate"/>
		<result column="COUNT" property="count"/>
		<result column="REVIEW_DATE" property="reviewDate"/>
		<result column="STATUS" property="reviewDate"/>
	</resultMap>
  
	<select id="listCountReview" resultType="_int">
	   SELECT COUNT(*) COUNT
		 FROM REVIEW
		WHERE STATUS = 'Y'
	</select>
	
	<select id="selectReviewList" resultMap="ReviewResultSet">
	     SELECT REVIEW_NO, NICKNAME, SUPPORT_NO, REVIEW_TITLE, RATE,  COUNT,  REVIEW_DATE
	       FROM REVIEW R
	       JOIN MEMBER ON(USER_NO = REVIEW_WRITER)
	      WHERE R.STATUS = 'Y'
	   ORDER BY REVIEW_NO DESC
	</select>
	
		<select id="selectSearchCount" resultType="_int" parameterType="hashmap">
		SELECT 
			   COUNT(*)
		  FROM 
		       REVIEW R
		  JOIN MEMBER ON (REVIEW_WRITER = USER_NO)
		 WHERE R.STATUS = 'Y'
		 <choose>
			 <when test="condition == 'reviewWriter'">
			   AND NICKNAME 
			 </when>
			 <when test="condition == 'RATE'">
			   AND RATE
			 </when>
			 <otherwise>
			 	AND REVIEW_TITLE
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%' 
	</select>
	
	<select id="selectSearchList" resultMap="ReviewResultSet" parameterType="hashmap">
		SELECT 
			   REVIEW_NO, NICKNAME, SUPPORT_NO, REVIEW_TITLE, RATE,  COUNT,  REVIEW_DATE
		  FROM 
		       REVIEW R
		  JOIN MEMBER ON (REVIEW_WRITER = USER_NO)
		 WHERE R.STATUS = 'Y'
		 <choose>
			 <when test="condition == 'reviewWriter'">
			   AND NICKNAME 
			 </when>
			 <when test="condition == 'RATE'">
			   AND RATE
			 </when>
			 <otherwise>
			 	AND REVIEW_TITLE
			 </otherwise>
		 </choose>
		  	   LIKE '%' || #{keyword} || '%' 
		  ORDER BY REVIEW_NO DESC  
	</select>
  
</mapper>