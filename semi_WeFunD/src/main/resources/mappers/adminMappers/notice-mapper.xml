<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminNoticeMapper">

	<resultMap type="adminNotice" id="noticeResultSet">
		<result column="NOTICE_NO" property="noticeNo"/>
		<result column="NICKNAME" property="noticeWriter"/>
		<result column="NOTICE_TITLE" property="noticeTitle"/>
		<result column="NOTICE_CONTENT" property="noticeContent"/>
		<result column="COUNT" property="count"/>
		<result column="NOTICE_DATE" property="noticeDate"/>
	</resultMap>

	<insert id="insertNotice" parameterType="adminNotice">
		INSERT 
		  INTO NOTICE
		  	   (NOTICE_NO, NOTICE_WRITER, NOTICE_TITLE, NOTICE_CONTENT )
		VALUES (SEQ_NNO.NEXTVAL, 1, #{noticeTitle}, #{noticeContent})
	</insert>
	
	<select id="selectCountNotice" resultType="_int">
		SELECT COUNT(*) COUNT
	      FROM NOTICE
	     WHERE STATUS='Y'
	</select>	
	
	<select id="selectListNotice" resultMap="noticeResultSet">
		SELECT NOTICE_NO, NICKNAME, NOTICE_TITLE, NOTICE_CONTENT, COUNT, NOTICE_DATE         	   
		  FROM NOTICE N
		  JOIN MEMBER ON(NOTICE_WRITER = USER_NO)
	     WHERE N.STATUS = 'Y'     	   
	     ORDER BY NOTICE_DATE DESC      	      
	</select>

	<update id="increaseCount">
		UPDATE NOTICE
		   SET COUNT = COUNT + 1
		 WHERE NOTICE_NO = #{noticeNo}
		   AND STATUS = 'Y'		
	</update>
	
	
	
	
	<select id="selectSearchCount" resultType="_int" parameterType="hashmap">
		SELECT 
			   COUNT(*)
		  FROM 
		       NOTICE N
		  JOIN MEMBER ON (NOTICE_WRITER = USER_NO)    
		 WHERE N.STATUS = 'Y'
		 <choose>
			 <when test="condition == 'noticeContent'">
			 	AND NOTICE_CONTENT
			 </when>
			 <otherwise>
			 	AND NOTICE_TITLE
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%' 
	</select>
	
	<select id="selectSearchList" resultMap="noticeResultSet" parameterType="hashmap">
		SELECT 
			   NOTICE_NO, NICKNAME, NOTICE_TITLE, NOTICE_CONTENT, COUNT, NOTICE_DATE
		  FROM 
		       NOTICE N
		  JOIN MEMBER ON (NOTICE_WRITER = USER_NO) 
		 WHERE N.STATUS = 'Y'
		 <choose>
			 <when test="condition == 'noticeContent'">
			 	AND NOTICE_CONTENT
			 </when>
			 <otherwise>
			 	AND NOTICE_TITLE
			 </otherwise>
		 </choose>
		  	   LIKE '%' || #{keyword} || '%' 
		  ORDER BY NOTICE_NO DESC  
	</select>
	
	
	
</mapper>
	

