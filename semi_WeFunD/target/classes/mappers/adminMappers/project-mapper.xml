<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminProjectMapper">

	<resultMap type="adminProject" id="ProjectResultSet">
		<result column="PROJECT_NO" property="projectNo" />
		<result column="NICKNAME" property="projectCreator" />
		<result column="PROJECT_NAME" property="projectName" />
		<result column="CATEGORY_NO" property="categoryNo" />
		<result column="CATEGORY_NAME" property="categoryName" />
		<result column="START_DATE" property="startDate" />
		<result column="END_DATE" property="endDate" />
		<result column="GOAL_AMOUNT" property="goalAmount" />
		<result column="BANK" property="bank" />
		<result column="ACCOUNT_NO" property="accountNo" />
		<result column="ACCOUNT_NAME" property="accountName" />
		<result column="PROJECT_CONTENT" property="projectContent" />
		<result column="COUNT" property="count" />
		<result column="APPLY_DATE" property="applyDate" />
		<result column="STATUS" property="status" />
	</resultMap>
	
	<resultMap type="adminSupport" id="SurpportResultSet">
		<result column="SUPPORT_NO" property="supportNo" />			
		<result column="ORDER_NAME" property="orderName" />	  		
		<result column="ORDER_PHONE" property="orderPhone" />    		
		<result column="lORDER_EMAIL" property="orderEmai" />   		
		<result column="RECEIVER_NAME" property="receiverName" />   
		<result column="RECEIVER_PHONE" property="receiverPhone" />   	
		<result column="RECEIVER_ADDRESS" property="receiverAddress" />
		<result column="ORDER_COMMENT" property="orderComment" />    	
		<result column="PRODUCT" property="product" />    			  
		<result column="PAYMENT" property="payment" />    			  
		<result column="SUPPORT_DATE" property="supportDate" />    	
	</resultMap>
	


	<select id="listCount" resultType="_int">
		SELECT COUNT(*) COUNT
		  FROM (SELECT PROJECT_NO, PROJECT_NAME, PROJECT_CREATOR, END_DATE
		  FROM PROJECT
		  JOIN (SELECT SUM(PAYMENT)A, PROJECT_NO
		          FROM SUPPORT
		         GROUP BY PROJECT_NO)
		 USING (PROJECT_NO)
		 WHERE GOAL_AMOUNT  <![CDATA[ <= ]]> A
		   AND STATUS = 'E')
	</select>

	<select id="ProjectSupportList" resultMap="ProjectResultSet">
		SELECT PROJECT_NO, PROJECT_NAME, NICKNAME, END_DATE
		  FROM PROJECT P
		  JOIN (SELECT SUM(PAYMENT)A, PROJECT_NO
				  FROM SUPPORT
				 GROUP BY PROJECT_NO)
		 USING (PROJECT_NO)
		  JOIN MEMBER ON (USER_NO = PROJECT_CREATOR)
		 WHERE GOAL_AMOUNT  <![CDATA[ <= ]]> A
		   AND P.STATUS = 'E'
		 ORDER BY PROJECT_NO DESC
	</select>

	<select id="SupportDetail" resultMap="SurpportResultSet">
		SELECT SUPPORT_NO,ORDER_NAME, ORDER_PHONE, ORDER_EMAIL,RECEIVER_NAME, RECEIVER_PHONE, RECEIVER_ADDRESS, ORDER_COMMENT, PRODUCT, PAYMENT, SUPPORT_DATE
		 FROM SUPPORT
		WHERE PROJECT_NO = #{projectNo}
	</select>
	
	<select id="projectListCount" resultType="string" parameterType="string">
		SELECT COUNT(*) COUNT
		  FROM PROJECT
		<choose>
			<when test='type == "Y"'>
				 WHERE STATUS = 'Y'
			 </when>
			 <when test='type == "N"'>
			 	WHERE STATUS = 'N'
			 </when>
			 <when test='type == "E"'>
			 	WHERE STATUS = 'E'
			 </when>
			 <when test='type == "X"'>
			 	WHERE STATUS = 'X'
			 </when>
			 <otherwise>
			 </otherwise>
		 </choose>
	</select>
	
	<select id="selectListProject" resultMap="ProjectResultSet" parameterType="string">
		SELECT PROJECT_NO, NICKNAME, PROJECT_NAME, APPLY_DATE
		  FROM PROJECT P
		  JOIN MEMBER ON (PROJECT_CREATOR = USER_NO)
  		<choose>
			<when test='type == "Y"'>
				 WHERE STATUS = 'Y'
			 </when>
			 <when test='type == "N"'>
			 	WHERE STATUS = 'N'
			 </when>
			 <when test='type == "E"'>
			 	WHERE STATUS = 'E'
			 </when>
			 <when test='type == "X"'>
			 	WHERE STATUS = 'X'
			 </when>
			 <otherwise>
			 </otherwise>
		 </choose>
		 ORDER BY PROJECT_NO DESC
	</select>
	
	<select id="projectSelectSearchCount" resultType="string" parameterType="hashmap">
		SELECT 
			   COUNT(*)
		  FROM 
		       PROJECT P
          JOIN MEMBER ON (PROJECT_CREATOR = USER_NO)  
   		<choose>
			<when test='type == "Y"'>
				WHERE P.STATUS = 'Y'
			 </when>
			 <when test='type == "N"'>
			 	WHERE P.STATUS = 'N'
			 </when>
			 <when test='type == "E"'>
			 	WHERE P.STATUS = 'E'
			 </when>
			 <when test='type == "X"'>
			 	WHERE P.STATUS = 'X'
			 </when>
			 <otherwise>
			 	WHERE 1 = 1
			 </otherwise>
		 </choose>
		 <choose>
			 <when test="condition == 'categoryName'">
			 	AND NICKNAME
			 </when>
			 <otherwise>
			 	AND PROJECT_NAME
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%' 
	</select>
	
	<select id="projectSelectSearchList" resultMap="ProjectResultSet" parameterType="hashmap">
		SELECT 
			   PROJECT_NO, NICKNAME, PROJECT_NAME, APPLY_DATE
		  FROM 
		       PROJECT P
          JOIN MEMBER ON (PROJECT_CREATOR = USER_NO)  
   		<choose>
			<when test='type == "Y"'>
				WHERE P.STATUS = 'Y'
			 </when>
			 <when test='type == "N"'>
			 	WHERE P.STATUS = 'N'
			 </when>
			 <when test='type == "E"'>
			 	WHERE P.STATUS = 'E'
			 </when>
			 <when test='type == "X"'>
			 	WHERE P.STATUS = 'X'
			 </when>
			 <otherwise>
			 	WHERE 1 = 1
			 </otherwise>
		 </choose>
		 <choose>
			 <when test="condition == 'categoryName'">
			 	AND NICKNAME
			 </when>
			 <otherwise>
			 	AND PROJECT_NAME
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%' 
		 ORDER BY PROJECT_NO DESC    
	</select>
	
	<select id="supportSelectSearchCount" resultType="_int" parameterType="hashmap">
        SELECT COUNT(*)                     
		  FROM PROJECT P
		  JOIN (SELECT SUM(PAYMENT)A, PROJECT_NO
				  FROM SUPPORT
				 GROUP BY PROJECT_NO)
		 USING (PROJECT_NO)
		  JOIN MEMBER ON (USER_NO = PROJECT_CREATOR)
		 WHERE GOAL_AMOUNT  <![CDATA[ <= ]]> A
		   AND P.STATUS = 'E'
          <choose>
			 <when test="condition == 'projectCreator'">
			 	AND PROJECT_CREATOR 
			 </when>
			 <otherwise>
			 	AND PROJECT_NAME
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%' 
	</select>
	
	<select id="supportSelectSearchList" resultMap="ProjectResultSet" parameterType="hashmap">
        SELECT PROJECT_NO, PROJECT_NAME, NICKNAME, END_DATE                    
		  FROM PROJECT P
		  JOIN (SELECT SUM(PAYMENT)A, PROJECT_NO
				  FROM SUPPORT
				 GROUP BY PROJECT_NO)
		 USING (PROJECT_NO)
		  JOIN MEMBER ON (USER_NO = PROJECT_CREATOR)
		 WHERE GOAL_AMOUNT  <![CDATA[ <= ]]> A
		   AND P.STATUS = 'E'
          <choose>
			 <when test="condition == 'projectCreator'">
			 	AND PROJECT_CREATOR 
			 </when>
			 <otherwise>
			 	AND PROJECT_NAME
			 </otherwise>
		 </choose>
		  LIKE '%' || #{keyword} || '%'
		 ORDER BY PROJECT_NO DESC 
	</select>
	
	
	
	
	

</mapper>